p8105\_hw3\_jx2371
================
Jingyu Xu
2018/10/13

Firstly，I set a globle option which hides the message and warning information.

``` r
knitr::opts_chunk$set(message = FALSE, warning = FALSE)
```

Problem 1
=========

data cleaning
-------------

Firstly，I did some data cleaning in this code chunck format the data to use appropriate variable names； focus on the “Overall Health” topic； include only responses from “Excellent” to “Poor”
organize responses as a factor taking levels ordered from “Excellent” to “Poor”

``` r
library(p8105.datasets)
library(tidyverse)
brfss = brfss_smart2010 %>%
  janitor::clean_names() %>%
  rename(state=locationabbr,location=locationdesc)%>%
  filter(topic == "Overall Health") %>% 
  filter(response == "Excellent"|response == "Very good"|response == "Good"|response == "Fair"|response == "Poor")%>%
  mutate(response=as.factor(response))
levels(brfss$response)=c("Excellent","Very good","Fair","Good","Poor")
```

answering questions
-------------------

1.selecting the states that were observed at 7 locations in 2002

``` r
brfss%>%
  filter(year==2002)%>%
  group_by(state,location) %>%
  summarize(n = n())%>%
  count(state)%>%
  filter(nn==7)
```

    ## # A tibble: 3 x 2
    ## # Groups:   state [3]
    ##   state    nn
    ##   <chr> <int>
    ## 1 CT        7
    ## 2 FL        7
    ## 3 NC        7

we can see from the result of the code chunk that CT,FL and NC had 7 locations observed in 2002.

2.draw a spaghetti plot showing the number of locations in each state from 2002 to 2010

``` r
brfss%>%
  group_by(state, year,location)%>%
  summarize(n=n())%>%
  group_by(state, year)%>%
  summarize(number=n())%>%
  ggplot(aes(x = year, y = number, color = state)) + 
  geom_line(size=0.3) +
  theme(legend.position = "bottom")
```

![](p8105_hw3_jx2371_files/figure-markdown_github/unnamed-chunk-3-1.png) We observe from the soaghetti plot that the trend of locations in most of the states is somehow stable, with little fluctuation. On the other hand, FL is unique in these observations that it changes dramatically by the year and reaches 40 in 2010, which is the most among all the states.

3.we can see from the dataset that the column data\_value refer to the proportion(%). To make it clear, I create a new column named "proportion" in percentage and select the data of 2002，2006 and 2010. Then, I caculate the mean and variance of the excellent data across locations in United states

``` r
excellent_data=filter(brfss,year=="2002" | year=="2006" |year=="2010",response=="Excellent",state=="NY")%>%
  select(year,state,location,response,data_value)%>%
  mutate(data_value=data_value/100)%>%
  rename(proportion=data_value)

mean_2002=mean((subset(excellent_data, year=="2002"))$proportion,na.rm = TRUE)
standard_var_2002=sqrt(var((subset(excellent_data, year=="2002"))$proportion,na.rm = TRUE))
mean_2006=mean((subset(excellent_data, year=="2006"))$proportion,na.rm = TRUE)
standard_var_2006=sqrt(var((subset(excellent_data, year=="2006"))$proportion,na.rm = TRUE))
mean_2010=mean((subset(excellent_data, year=="2010"))$proportion,na.rm = TRUE)
standard_var_2010=sqrt(var((subset(excellent_data, year=="2010"))$proportion,na.rm = TRUE))
```

now a table is create:

``` r
tibble(year=c("2002", "2006", "2010"), standard_variance=c(standard_var_2002,standard_var_2006,standard_var_2010),
                      mean=c(mean_2002, mean_2006, mean_2010))%>%
knitr::kable()
```

| year |  standard\_variance|       mean|
|:-----|-------------------:|----------:|
| 2002 |           0.0448642|  0.2404000|
| 2006 |           0.0400083|  0.2253333|
| 2010 |           0.0356721|  0.2270000|

4.For each year and state, compute the average proportion in each response category (taking the average across locations in a state). Make a five-panel plot that shows, for each response category separately, the distribution of these state-level averages over time.

``` r
brfss%>%
  select(year,state,location, response, data_value)%>%
  group_by(year,state,response)%>%
  summarise(average_proportion=mean(data_value))%>%
  ggplot(aes(x = factor(year), y = average_proportion, fill=year)) + 
  geom_boxplot()+
  facet_grid(.~response)+
  theme(legend.position = "bottom")+
  theme(axis.text.x = element_text(face="bold", size=15, angle = 90))
```

![](p8105_hw3_jx2371_files/figure-markdown_github/unnamed-chunk-6-1.png) We can observe from the boxplots that the average proportion ordered from highest to the lowest from an overall average trend aspect is:poor response, fair response, excellent response, very good response and good response. And there are some outliers in all of the response section.
